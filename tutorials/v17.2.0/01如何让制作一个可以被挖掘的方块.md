# 如何制作一个Shoveled BlockV17.2.0

本文档创建于2023年3月20日，埃德蒙顿，加拿大

## 下载Example Mod

**重要**：如果你已经有自己的项目，则可以忽略这一步

[wzsjc2020/fabric-example-mod-1.19.2-prefab (github.com)](https://github.com/wzsjc2020/fabric-example-mod-1.19.2-prefab)

复制此仓库内所有的文件到本地



## 添加依赖包

```
build.gradle
```

```java
repositories {
	maven {
		url "https://maven.pkg.github.com/wzsjc2020/treasure-hunt-lib"
            credentials {
                username = "wzsjc2020"
                password = "see github 'how to use'"
            }
	}
}

dependencies {
	modImplementation ("com.wzssoft:treasurehuntlib:${"1.19.2-17.2.0"}")
}
```



## 添加一个第一个方块

### 创建方块

```
com.wzssoft.modid.block.common.ShoveledGrassBlock.java
```

```java
package com.wzssoft.modid.block.common;

import com.wzssoft.treasurehuntlib.block.common.AbstractShoveledBlock;

/**
 * added since 17.0.1
 */
public class ShoveledGrassBlock extends AbstractShoveledBlock {


    public ShoveledGrassBlock(Settings settings) {
        super(settings);
    }
}
```



### 注册方块物品

这个教程我们以制作一个可以挖掘的草方块为例

```
com.wzssoft.modid.block.MODIDBlocks.java
```

```java
public static final Block SHOVELED_GRASS_BLOCK = registerBlock("shoveled_grass_block",
        new ShoveledGrassBlock(FabricBlockSettings.of(Material.SOLID_ORGANIC).strength(0.6f).sounds(BlockSoundGroup.GRASS)));
```

```
com.wzssoft.modid.item.MODIDBlockItems.java
```

```java
public static final Item SHOVELED_GRASS_BLOCK_ITEM = registerBlockItem("shoveled_grass_block",
        new BlockItem(MODIDBlocks.SHOVELED_GRASS_BLOCK, new FabricItemSettings().group(ItemGroup.BUILDING_BLOCKS).rarity(Rarity.COMMON)));
```

这个方块将会被添加在建筑方块里

### 设置方块渲染

```
fabric.mod.json
```

```
"entrypoints": {
  "main": [
    "com.wzssoft.modid.MODIDMod"
  ],
  "client": [
    "com.wzssoft.modid.MODIDClient"
  ]
},
```

如果你已经配置好client端则省略上面配置的过程



```
com.wzssoft.modid.MODIDClient.java
```

```java
public class MODIDClient implements ClientModInitializer {
    @Override
    public void onInitializeClient() {

        BlockRenderLayerMap.INSTANCE.putBlock(MODIDBlocks.SHOVELED_GRASS_BLOCK, RenderLayer.getCutout());
        ColorProviderRegistry.ITEM.register((stack, tintIndex) -> 0x5C9854, MODIDBlocks.SHOVELED_GRASS_BLOCK);
        ColorProviderRegistry.BLOCK.register(((state, world, pos, tintIndex) -> world.getColor(pos, BiomeColors.GRASS_COLOR)), MODIDBlocks.SHOVELED_GRASS_BLOCK);
    }
}
```



### 设置方块模型

方块渲染，方块模型这边就不演示了，即使不添加也不会报错只会变成紫黑块，

查看Fabirc Wiki设置方块模型教程[tutorial:blockstate [Fabric Wiki\] (fabricmc.net)](https://fabricmc.net/wiki/tutorial:blockstate)



### 绑定方块

重要：此标题在17.1.3教程中为绑定宝藏附魔生效的方块

重要：此标题在17.1.7教程中为绑定方块

重要：此章节较17.1.7教程有较大的改变，需要特别注意

```
com.wzssoft.modid.mixin.GrassBlockMixin.java
```

```java
@Mixin(GrassBlock.class)
public class GrassBlockMixin implements Shovelable {

...

    @Override
    public BlockState getShoveledState(BlockState ShovelableState, World world, BlockPos pos, PlayerEntity player) {
        return MODIDBlocks.SHOVELED_GRASS_BLOCK.getDefaultState();
    }
}
```

我们要去Mixin中让原版中的草方块实现 Shovelable

在这一个小节，我们仅需要重写getShoveledState（）这一个方法即可



```
com.wzssoft.modid.block.common.ShoveledGrassBlock.java
```

```java
public class ShoveledGrassBlock extends AbstractShoveledBlock {
    public ShoveledGrassBlock(Settings settings) {
        super(settings);
    }

    @Override
    public BlockState getShovelableState(BlockState shoveledState, World world, BlockPos pos, PlayerEntity player) {
        return Blocks.GRASS_BLOCK.getDefaultState();
    }
}
```

然后在对应的ShoveledGrassBlock 中 重写getShovelableState 方法

这样我们就完成了方块的绑定



### 让方块可以用挖掘铲挖掘

完成绑定方块后，你会发现使用挖掘铲挖掘草方块似乎并不起作用，那是因为我们还没有设置草方块可以被挖掘铲挖掘

```
com.wzssoft.modid.mixin.GrassBlockMixin.java
```

```Java
@Mixin(GrassBlock.class)
public class GrassBlockMixin implements Shovelable {

    @Override
    public boolean canShovel(BlockState ShovelableState, World world, BlockPos pos, PlayerEntity player) {
        return true;
    }

...
}
```

目前阶段，我们只需要实现让这个方块可以被挖掘，但是并不需要额外的判断条件

我们只需要去重写canShovel（）方法，并设置返回值为true



千万不要忘了在modid.mixin.json中加入GrassBlockMixin.java的路径

```json
{
  "required": true,
  "minVersion": "0.8",
  "package": "com.wzssoft.modid.mixin",
  "compatibilityLevel": "JAVA_17",
  "mixins": [
    "GrassBlockMixin"   <-需要在此加入路径，否则不会生效
  ],
  "client": [
  ],
  "injectors": {
    "defaultRequire": 1
  }
}
```

现在进入游戏，你可以看到用挖掘铲挖掘草方块时，草方块转换成了我们模组中添加的挖掘过的草方块



## 为方块添加更多的功能

### 添加自定义掉落物

重要：添加自定义掉落物与v17.1.7教程中完全不同，需要特别注意

```
com.wzssoft.modid.block.common.ShoveledGrassBlock.java
```

```java
public class ShoveledGrassBlock extends AbstractShoveledBlock {
    public static final Identifier LOOTS = new Identifier(TreasureHuntLib.MODID, "items/demo_loot_table");
    public ShoveledGrassBlock(Settings settings) {
        super(settings);
    }


...
    
    @Override
    public boolean shouldDropLoots(BlockState shovelableState, BlockState shoveledState, World world, BlockPos pos, PlayerEntity player) {
        return true;
    }

    @Override
    public List<ItemStack> getLootsItemStack(BlockState shovelableState, BlockState shoveledState, World world, BlockPos pos, PlayerEntity player) {
        LootContext lootContext = (new LootContext.Builder((ServerWorld) world)).random(world.random).build(LootContextTypes.EMPTY);
        LootTable lootTable = ((ServerWorld) world).getServer().getLootManager().getTable(LOOTS);
        return lootTable.generateLoot(lootContext);
    }
}
```

我们需要重写其中的getLootsItemStack()方法 和 shouldDropLoots（）方法，这边使用的LOOTS是Treasure hunt lib 中自带的一个掉落物列表，如果正确的话，它会掉落钻石，绿宝石，铁和黄金（仅供测试使用，请不要在你的模组中使用）



### 添加随机刻

重要：如果想让这个物品具有随机刻，可以重写方法中的 hasRandomTicks（）或者在注册方块时添加

```java
FabricBlockSettings.of(Material.SOLID_ORGANIC).strength(0.6f).sounds(BlockSoundGroup.GRASS).ticksRandomly()
```

```
com.wzssoft.modid.block.common.ShoveledGrassBlock.java
```

```java
public class ShoveledGrassBlock extends AbstractShoveledBlock {

    public ShoveledGrassBlock(Settings settings) {
        super(settings);
    }

    @Override
    public boolean hasRandomTicks(BlockState state) {
        return true;
    }

    @Override
    public void randomTick(BlockState state, ServerWorld world, BlockPos pos, Random random) {
        this.setToOriginalBlock(world, pos);
    }
}
```

现在这个方块在一个随机刻后会还原成被挖掘之前的样子



## 其他更多功能

如果想实现在此方块上种自定义植物，请查看下一篇笔记

